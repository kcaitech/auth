# KCAuth - Unified Authentication Service

A simple account system implemented in Golang, supporting multiple login methods and single sign-on. Provides a complete user authentication and authorization solution.

## 🚀 Features

### Authentication Methods
- **Account Password Login** - Traditional username/password authentication
- **Email Login** - Email verification code login
- **Phone Number Login** - SMS verification code login
- **Third-party Login**
  - Google OAuth2.0
  - WeChat Login
  - WeChat Mini Program Login
- **JWT Tokens** - Support for access tokens and refresh tokens
- **Session Management** - Redis-based session system

### Core Features
- 📱 SMS/Email verification codes
- 🖼️ Avatar upload and management
- 👥 User management backend
- 📊 Real-time data statistics
- 🌐 Multi-language support
- 🔒 Security protection (rate limiting, IP whitelist, etc.)
- 📈 Monitoring metrics (Prometheus)

### Technology Stack
- **Backend**: Go 1.23+ / Gin / GORM / Redis / MySQL
- **Frontend**: Vue 3 / TypeScript / Vite
- **Storage**: MinIO / AWS S3 / Alibaba Cloud OSS
- **Deployment**: Docker / Docker Compose

## 📦 Project Structure

```
kcauth/
├── server/           # Backend service (Go)
├── web/             # Frontend user interface (Vue)
├── admin-web/       # Admin backend (Vue)
├── client/          # Go client library
├── quickstart/      # Quick start configuration
└── tools/           # Utility scripts
```

## 🚀 Quick Start

```bash
cd quickstart
docker-compose up -d
```

3. **Access Services**
- User Interface: http://localhost:8080
- Admin Backend: http://localhost:8081
- MinIO Console: http://localhost:9001


## ⚙️ Configuration

### Database Configuration
```yaml
db:
  user: "root"
  password: "password"
  host: "localhost"
  port: 3306
  database: "kcauth"
  charset: "utf8mb4"
```

### Redis Configuration
```yaml
redis:
  addr: "localhost:6379"
  password: ""
  db: 0
```

### Storage Configuration
Supports multiple storage providers:
- **MinIO** (Local object storage)
- **AWS S3** (Amazon cloud storage)
- **Alibaba Cloud OSS** (Alibaba cloud object storage)

```yaml
storage:
  provider: "minio"  # minio, s3, oss
  endpoint: "localhost:9000"
  region: "zhuhai-1"
  accessKeyID: "your-access-key"
  secretAccessKey: "your-secret-key"
  attatchBucket: "attatch"
```

### Authentication Provider Configuration

#### Google OAuth2.0
```yaml
auth:
  google:
    client_id: "your-google-client-id"
    client_secret: "your-google-client-secret"
    redirect_url: "http://localhost:8080/auth/google/callback"
    scopes:
      - "https://www.googleapis.com/auth/userinfo.email"
      - "https://www.googleapis.com/auth/userinfo.profile"
```

#### WeChat Login
```yaml
auth:
  weixin:
    app_id: "your-wechat-app-id"
    app_secret: "your-wechat-app-secret"
    redirect_url: "http://localhost:8080/wechat/callback"
    domain_verify_token: "your-domain-verify-token"
```

#### SMS Service
```yaml
auth:
  sms:
    provider: "aliyun"  # aliyun, tencent
    access_key: "your-access-key"
    secret_key: "your-secret-key"
    sign_name: "Verification Code"
    template_id: "SMS_123456789"
    region: "cn-hangzhou"
```

#### Email Service
```yaml
auth:
  smtp:
    host: "smtp.example.com"
    port: 587
    username: "noreply@example.com"
    password: "your-password"
    from: "KCAuth <noreply@example.com>"
```

### Admin Backend Configuration
- Password is generated by tools in the tools directory
```yaml
auth_admin:
  enabled: true
  secret_key: "change-this-to-a-secure-random-string"
  accounts:
    - username: "admin"
      password: "$2a$10$hashed-password"
      roles:
        - "super_admin"
  allowed_ips:
    - "127.0.0.1"
    - "::1"
  require_tls: false
  session_ttl: 30
  login_timeout: 60
```

### Trusted Clients
- Trusted clients are typically your own business backends deployed
- Trusted clients support batch user information retrieval, etc.
- client_secret is generated by tools in the tools directory
```yaml
auth_trusted_clients:
  - client_id: "kcserver"
    client_secret: "YOUR_TRUSTED_CLIENT_SECRET"
    allowed_ips:
      - "*"
    scopes:
      - "read:users" 
```

## 🔧 Client Integration

### Go Client

```go
import "kcaitech.com/kcauth/client/auth"

// Create JWT client
jwtClient := auth.NewJWTClient("http://auth-service:8080")

// Create JWT middleware
jwtMiddleware := auth.NewJWTMiddleware(jwtClient)

// Use in Gin
r := gin.Default()
protected := r.Group("/api")
protected.Use(jwtMiddleware.AuthRequired())
{
    protected.GET("/profile", func(c *gin.Context) {
        // Handle protected resources
    })
}
```

## 🔒 Security Features

- **JWT Tokens** - Secure stateless authentication
- **Token Refresh** - Automatic refresh of expired tokens
- **Rate Limiting** - Protection against brute force attacks
- **IP Whitelist** - Admin backend access control
- **CORS Configuration** - Cross-origin request control
- **HTTPS Support** - Encrypted transmission in production

## 🌍 Internationalization

Supports multi-language interfaces:
- Chinese (zh-CN)
- English (en-US)

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE.txt) file for details.

